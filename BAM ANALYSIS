



#must first load samtools, create indices 
module load bioinformatics/samtools/1.9

#samtools index in shell script

#rsync indices of both STAR and HISAT2 

DIR=home/emtraining/bam/BAM
#1 ESC_DMSO
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X1_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X1_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#2 ESC_CHX
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X2_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X2_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#3 ESC_Total
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X3_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X3_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#4 ESC_Cyto
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X4_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X4_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#6 NSC_DMSO
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X6_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X6_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#7 NSC_CHX
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X7_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X7_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#8 NSC_Total
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X8_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X8_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam
#9 NSC_Cyto
Rscript /home/emtraining/bam/BAM/runCsaw.R "$DIR"/STAR/13799X9_161209_D00294_0278_BCAEAJANXX_1.fastq.gzAligned.sortedByCoord.out.bam "$DIR"/HISAT2/13799X9_161209_D00294_0278_BCAEAJANXX_1_HISAT.bam


#bamDiff

This takes as input a comma separated value (csv) file and two or more .bam files. The csv should be a file output by runCsaw.R (e.g. column 2 seqid, column 3 start, column 4 stop, column -1 p-value) containing regions in which the .bam files show statistically different peaks.

###STEP ONE: SAM_comparitor calculates some summary statistics for each bam file, including the total number of reads contained, the total number of alignments (can be more than the number of reads if reads align multiple times), the proportion of reads that map uniquely (only once), and the proportion of reads which are unmapped.

###STEP TWO: For each region identified in the csv, provides text-based tables displaying the results for pairwise comparisons of the .bam files. This includes the number of reads in the identified region in one .bam file which are unmapped in the other. In addition, the number and location of mapping partners in the other .bam are analyzed for each mapping read, and the median values are reported. The location metric is simply the ration of mapping partners which fall within the identified region in the partner .bam file, out of all mapping partners in that file.

###STEP THREE (yet to be implemented): Include information about read quality (based on CIGAR strings -- perfect mapping, short matches, indels, etc). Use annotation file (.gff) to look at where these alternate mappings are:

pseudo genes
repetitive regions
alternative exon splicing sites?
